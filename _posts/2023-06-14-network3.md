---
title: "네트워크 2-1 애플리케이션 계층: SMPT와 소켓 프로그래밍"

categories:
  - Network
tags:
  - Network
---

## SMTP(Simple Mail Transper Protocol)

#### 1. SMTP의 구조

---

- SMTP는 문자 그대로 메일을 간단하게 보낼 수 있게 도와주는 프로토콜이다.
- 메일을 보내는 과정은 3가지 요소로 이루어져 있다.

1.  user-agent: 메일을 보내는 개인 (클라이언트)
2.  mail-server: gmail, outlook 등과 같은 메일 서버
3.  smtp: 메일을 전송하느 프로토콜, 유저와 서버간의 메일전달 수단

- 메일을 받는사람은 24시간 컴퓨터를 켜놓지 않기 때문에 부재중일때 메일을 대신 받아줄 매체가 필요한데 그것이 바로 mail-server다.
- 수신자는 원하는 시간에 컴퓨터를 켜서 mail-server에 접속해 메일을 확인한다.
- mail-server는 메일을 보낼때 사용되는 mail-queue와 받은 메일을 저장하는 mail-box로 이루어져 있다.
- user-agent는 outlook이나 웹 브라우저의 gmail같은 프로세스다.
- http는 request와 response 두가지 메세지가 있으나, smtp는 여러개의 구조의 메세지가 분할되서 주고받아진다.
- 메일을 받는것은 smtp가 아닌 별도의 프로토콜(pop, imap)등이 있으나 최근엔 웹 브라우저에서 메일을 이용하기 때문에 http요청으로 메일을 수신한다.

#### 2. 메일이 보내지는 과정

---

1. 엘리스(user agent)는 엘리스의 mail server에 있는 mail queue에 보내고자 하는 메일을 전송한다.
2. 엘리스의 mail server는 mail queue에서 자기 순서가 되면 밥의 mail server의 mail box로 메일은 전송한다.
3. 밥(user agent)은 원하는 시간에 mail server에 접속하여 mail box에 있는 메일을 열어볼 수 있다.

- http는 클라이언트가 서버에서 데이터를 *가져오는(pull)*형태이고, smtp는 보내고자 하는 데이터를 클라이언트가 서버로 _밀어넣는(push)_ 형태이다.
  > 이때 서버와 클라이언트의 표현적 차이는 데이터를 밀어내는 쪽이 클라이언트, 받는쪽이 서버의 관계를 가진다.

## 소켓 프로그래밍

#### 1. 소켓 프로그래밍이란?

---

- 네트워크 프로그래밍은 프로세스간의 메세지 교환이다. 이러한 프로세스가 다른 컴퓨터간에 존재할때 통신하기 위하여 OS가 제공해주는 인터페이스가 있는데 이러한 인터페이스가 소켓이며, 소켓은 os에서 제공하는 인터페이스기 때문에 API로 분류됨.
- 소켓이라는 인터페이스를 통해서 메세지를 하위 계층으로 내려보내면 반대편의 소켓에서 메세지를 받을 수 있다.
- 이때 tcp와 udp라는 두가지 프로토콜이 존재하는데 이 특징이 다른 두가지 프로토콜을 위한 소켓이 따로 존재한다.
  > 시스템 프로그래밍: 시스템 콜을 공부하는 과목, 어떤 파일을 읽을때 해당 파일의 로우레벨 데이터를 직접 보는게 아닌 시스템 콜을 이용하면 os가 데이터를 읽어서 사용자에게 보여준다. 이것들도 전부 os가 제공하는 api다. 사용자는 내부적으로 어떻게 데이터를 읽는지, 소켓이 사용되는지 알 필요 없이 api규격에 맞게 사용하면 된다. 소켓 프로그래밍은 이러한 api를 익히는것이다.

#### 2. tcp 소켓 프로그래밍 (서버 측)

---

- 클라이언트와 서버가 존재한다고 가정하자, 서버는 항상 열려있어야 하기 때문에 서버에서 먼저 시스템콜 *socket()*으로 소켓을 준비시킨다. 이때 tcp 소켓임을 명시한다.
- 그 직후 *bind()*라는 시스템콜로 해당 소켓을 특정 포트에 맵핑시킨다. _ex. 웹소켓은 80번 포트._
- 그 다음 _listen()_ 시스템콜로 이 소켓은 요청을 받는 소켓임을 명시함. 서버측에서만 호출하는 메서드다.
- 그 다음은 accept() 시스템 콜로 요청 메세지를 계속 기다리는 대기상태로 만든다.(blocking call 이라고 함/ block until connection from client).

#### 3. tcp 소켓 프로그래밍 (클라이언트 측)

---

- 클라이언트가 요청을 원할때 socket()으로 tcp 소켓을 만들고 connect() 시스템콜(ip 주소 등의 정보가 필요)로 tcp three-way-handshaking 서버와 커넥션이 생긴다.
- 이때 서버의 blocking이 풀리면서 write(클라이언트) read(서버) 등의 통신이 이루어진다.
  > 이때 클라이언트는 bind()를 하지 않는데 서버와 다르게 클라이언트는 특정 포트를 명시할 필요없이 아무 포트나 사용하면 되기 때문이다.
- 이후엔 read() write()를 주고받고 close()로 연결을 끊음으로써 통신을 종료한다.
  > 각 시스템 콜은 전부 사용법이 있다. c의 함수처럼 인자로 넣어주는 정보들(도메인, 프로토콜)을 기입해서 사용한다.

#### 4. 웹소켓 서버 프로그래밍

---

> ppt에 서버측 tcp 웹 소켓 프로그래밍에 대한 간단한 예시가 있었다. 이러한 예제를 쭉 따라가면서 소켓 프로그래밍을 한다면 간단한 웹서버를 만들수 있다.

- 소켓프로그래밍 프로젝트를 한다는것은 웹 서버를 구현하는것이다. 클라이언트는 브라우저고 메세지를 보내고 응답을 받는역할만 가지기 때문에 구현할것이 없다.
- 소켓을 만들고 읽기 전용으로 전환하고 대기하면서 요청으로 들어온 메세지를 서버측에서 읽는것이 1차 과제였다.

> 요청예시 169.123.543.222:8888/moving.gif -> ip주소 : 포트번호 / 원하는 파일
