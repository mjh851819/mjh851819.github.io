---
title: "네트워크 2-3 애플리케이션 계층: DNS(Domain Name Service)"

categories:
  - Network
tags:
  - Network
---

> 이 글은 KOCW에서 제공하는 한양대학교 이석복 교수님의 컴퓨터 네트워크 강의를 기반으로 내용을 정리하고 복습하기 위한 용도로 작성되었습니다.

## DNS(Domain Name Service)

#### 1. DNS란?

---

- domain name service: 호스트의 도메인 네임을 호스트의 네트워크 주소로 바꾸거나 그 반대의 변환을 수행하는 서비스
- www.naver.com 같은 도메인 이름은 소켓통신에서 사용할 수 없다. 상대방 소켓에 접근하기 위해선 상대방 서버의 ip주소를 알아야한다.
- 따라서 www.naver.com을 ip주소로 변환해줘야 하는데 이를 담당하는것이 DNS이다.도메인을 브라우저에 입력하면 DNS가 이를 호스트의 ip주소로 치환해준다.
- 가장 쉬운 구현법은 네임 서버 하나에 모든 정보를 저장해두고 도메인 주소요청을 ip주소로 응답해주는 방식이었으나 지금은 이런식으로 사용하지 않는다.
- 이유는 네임서버가 터지면 모든 시스템이 마비되고, 저장할 데이터의 크기가 너무 커서 하나의 서버에 두는것은 비 효율적이기 때문이다.
- 데이터베이스 계층화, 분산화로 이를 해소한다.

#### 2. 계층화와 DNS의 구조

---

- DNS의 계층화: 가장 윗 계층에 *root name server*가 존재하고 그 하위에 .net, .com 등의 _top level domain_ 계층적인 구조로 이루어져 있다.
  > root서버는 전세계의 12-13개의 서버가 있고 하위에 .net, .com 등의 주소를 관장한다. top level domain도 amazon.com등 자기 하위 도메인을 관장한다.
- 제일 하위에는 *authoritative name server*가 있으며 인터넷에 존재하는 모든 기관들은 자신의 네트워크의 *authoritative dns server*를 운영해야 한다.
- authoritative dns server는 자기 기관이 보유하고있는 머신들의 호스트 네임에 대한 ip맵핑을 책임지는 서버다.

> ##### 도메인 네임과 호스트네임?

![도메인과 호스트](https://velog.velcdn.com/images%2Fminjae-mj%2Fpost%2Fcddacd52-b32e-4eaf-9825-d3bc6fa1c247%2FGroup%203.png)

간단히 설명하자면 *도메인 네임*은 네트워크에 부여되는 이름이다. .com 혹은 .amazon과 같이 분류되며 계층적으로 이루어져 있어 최상위 루트 도메인에서부터 내려온다.  
호스트 네임은 한 네트워크를 구성하는 호스트들을 구분하기 위해 부여된 이름이다. 위의 예시에서 amazon이라는 가상의 네트워크가 있다고 가정할때 blog.amazon / www.amazon / cafe.amazon 등의 이름에서 앞의 blog, www, cafe등의 이름이 호스트들을 구분하는 호스트 네임이다.

> _참고 자료: https://velog.io/@minjae-mj/%ED%98%B8%EC%8A%A4%ED%8A%B8-%EB%84%A4%EC%9E%84%EA%B3%BC-%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%84%A4%EC%9E%84_

#### 3. DNS와 authoritative dns server의 역할

---

> 한양대학교의 홈페이지인 www.hanyang.ac.kr 을 브라우저에 입력하면 어떻게 될까?

1. 한양대학교 서버로 요청을 보낸다 (www.hanyang.co.kr).
2. (최상위 루트부터 검색한다고 가정했을때)DNS를 통해서 루트서버 > 탑레벨 도메인 > co.kr >> ... 쭉쭉 타고 내려와셔 마지막에 한양대학교의 네트워크의 authoritative dns server까지 도착한다.
3. 한양대학교 authoritative dns server에 www.hanyang.co.kr을 검색하면 www이라는 호스트 네임을 가진 컴퓨터(전산실 어딘가에 있는)의 ip주소를 찾을 수 있다.

- 이런식으로 각 네트워크의 호스트마다 별도의 이름과 ip주소가 존재하는데 이를 맵핑해주고 찾을수 있게 도와주는 것이 authoritative dns server의 역할이다.

  - 추가로 이렇게 ip주소와 도메인 이름을 분리함으로써 또다른 장점이 있다.
  - ip주소는 그냥 숫자로 이루어진 주소지만 도메인 이름은 각각 의미를 지니고 있다.
  - 따라서 사용자들은 도메인 주소 자체로 해당 사이트의 의도와 의미를 예측할 수 있다.
  - 또한 ip주소는 컴퓨터의 물리적인 주소와 밀접한 관련을 가진다. 따라서 어떠한 물리적 이유로 서버의 ip주소가 바뀔수 있지만 그때 도메인 주소는 변하지 않아서 사용자 입장에서 불편을 겪지 않고 언제든 네트워크에 접속할 수 있다.

#### 4. 캐시의 역할을 하는 로컬 네임서버

---

- 각 기관은 내부적으로 외부의 도메인과 ip주소를 저장하는 로컬네임서버를 두고있다.
- 만약 성균관대에서 한양대학교로 접속하고자 할때 성균관대의 클라이언트측에서 직접 dns로 질의하러 가는것이 아니라 로컬네임서버가 중간에서 일종의 프록시(웹캐시)역할을 해준다.
- 검색할 도메인의 ip주소가 성균관대의 네임서버에 저장되어 있으면 바로 클라이언트에 ip주소를 보내주고 그게 아니라면 그때서야 dns를 통해 주소를 받아온다.
- 추가로 이때도 로컬네임서버에 www.hanyang.ac.kr 주소가 캐시에 없으면 직접 root서버에 물어보는게 원래는 맞지만 네임 서버에 만약 ac.kr의 주소가(하위 계층의 도메인 네임 서버) 있으면 그쪽으로 가서 물어본다.
- 이렇게 매번 루트도메인 까지 가는것이 아닌 최대한 짧은 거리로 한양대학교의 authoritative dns server로 들어가서 ip주소를 좀 더 빠르게 받을 수 있다.

#### 5. DNS server의 레코드와 데이터 저장 방식

---

- 위에서 설명한 캐시는 앞서 설명했듯 정보의 변경에 취약하기 때문에 각 캐시에 ttl이라는 변수를 두어 일정 기간이 지나면 삭제하는 방식으로 일관성 문제를 해소한다.
- dns데이터베이스의 레코드는 4개의 필드가 존재한다.
- [ name, value, _type_, ttl ] [이름, ip주소, _type_, 캐시제한시간]
- 각 레코드의 type이 무엇이느냐에 따라 레코드의 의미가 크게 달라진다.
- type = A의 의미 : 일반적인 hostname, ip주소의 형태로 저장되며 해당 레코드는 A(address)타입을 가진다.
- type = NS의 의미 : domainName, hostname의 형태로 저장되며 해당 레코드는 NS타입을 가진다.

#### 6. DNS 의 작동과정

---

- root서버의 데이터 베이스에는 NS타입의 .com의 도메인 이름과 dns.???.com 호스트 네임이 맵핑된 레코드가 존재한다.
- 이것의 의미하는것은 .com 도메인의 하위 도메인 네트워크를 찾기 위해서는 dns.???.com의 .com 도메인 네임 서버로 이동해야한다는 의미다.
- 이때 추가로 A타입의 레코드와 항상 쌍을 이루며 존재하는데 dns.???.com 호스트 네임과 7.7.7.7 의 ip주소가 A타입 레코드로 존재하여 루트네임서버 > 하위 DNS 네임서버로 이동할 수 있다.
- 따라서 DNS에서 루트서버부터 탐색을 시작한다고 했을때 응답으로 항상 NS타입과 A타입 두개의 레코드를 받으면서 하위 네임서버를 탐색한다.
- 마지막에 목적지의 authoritative dns server에서 A타입 레코드만을 응답받으면 원하던 ip주소를 얻은것이므로 탐색을 종료한다.

#### 추가 정보

---

- 위의 dns에서의 모든 질의과정도 결국 클라이언트 - 서버간의 통신이므로 tcp혹은 udp과정일것이다. 현대의 dns서비스는 udp로 구성되어있다. 왜일까?
- 이는 tcp의 단점과 dns의 특징때문이다.
- tcp는 신뢰성이 있는대신 초반 연결을 위한 준비에 생각보다 비용이 많이 필요하다.
  http통신 전에 주소를 알기 위한 dns에서 tcp통신을 이용하면 비용이 너무 많이 늘어난다.
- 또한 dns서비스로 받아오는 데이터는 http통신과 비교했을때 매우 적은 용량이기때문에 중간에 로스되어도 타격이 크지 않기 때문에 udp를 사용해도 큰 문제가 없다.
