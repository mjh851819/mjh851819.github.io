---
title: "네트워크 4-3 네트워크 계층: Fragmentation과 ICMP 그리고 routing Algorithm"

categories:
  - Network
tags:
  - Network
---

> 이 글은 KOCW에서 제공하는 한양대학교 이석복 교수님의 컴퓨터 네트워크 강의를 기반으로 내용을 정리하고 복습하기 위한 용도로 작성되었습니다.

## Fragmentation

- 다시 ip의 포멧을 살펴보자.  
  ![5-2](https://github.com/mjh851819/mjh851819.github.io/assets/70308520/2c78926c-7333-42be-b8e6-e0fda67773d3)
- 이전에 ip의 헤더를 알아볼때 2번째줄의 헤더는 생략하고 넘어갔다. 저 헤더는 어떤 의미일까?
- 4000바이트의 ip패킷을 만들어 보냈다고 가정하자 만약 1500바이트까지의 패킷만 보낼수 있는 링크(MTU = 1500)가 있다면 어떻게 될까?
- 해당 패킷을 쪼갤수 있는만큼 쪼개서 나누어 보낸 후 목적지에서 다시 합쳐져야만 한다.
- 이때 패킷을 쪼개고 합치는데 사용하는 정보가 필요한데 그 값을 기입하는것이 16-bit identifier와 fragflag, fragment offset 이다.

#### 1. fragmentation(분열, 파쇄)

---

![5-8](https://github.com/mjh851819/mjh851819.github.io/assets/70308520/8bf09b58-9f66-4851-8116-c81fcd157777)

- 4000바이트를 보내는데 MTU 1500인 링크를 만나는 위의 상황과 같은 상황이 있다.
- 이때 데이터는 그림처럼 3개로 쪼개지는데 헤더값의 의미는 다음과 같다.

1. length = 데이터의 길이
2. id = 데이터를 합칠때 필요한 원본의 id
3. fragflag = 데이터를 쪼갰을때 내 다음 합쳐질 조각이 있는지 flag
4. offset = 전체 데이터에서 나의 위치(인덱스)

> 1500바이트의 다음 offset은 뭘까? 헤더 20바이트를 제외한 1480이다.
> 그런데 헤더를 작성할때 비트를 절약하기 위해서 /8을 해줘 3비트를 빼줬기에 1480/8 = 185가 나온것이다.

## ICMP(Internet control message protocol)

---

- 네트워크 내에서 라우터와 호스트간 대화하기 위한 프로토콜.
- 라우터에 문제가 생겼을때 이를 다른 라우터에 알리기 위해서는 ip 패킷에 icmp메세지를 담아서 정보를 교환한다.
- icmp는 몇개의 코드로 이루어져있다.
- traceroute 로 icmp 이해하기
  > traceroute: 특정 목적지까지 거치는 라우트를 표시해주는 유틸리티
  > 목적지를 설정한 데이터의 ttl(라우터를 n번 거칠수 있다)를 1로 설정해서 보내면 가장 첫번째 라우터에서 loss된다. 이때 icmp메세지가 클라이언트에 도착하는데
  > 이런식으로 라우터 정보를 출력해서 traceroute를 구현할 수 있다.

ic- mp는 사용자의 데이터가 아닌 네트워크 내부 상황을 담은 데이터를 전달할때 사용된다

## IPv6

- addr 공간의 확장 -> 128bit (지구 모든 해변가의 모래알 개수의 합보다 많은양의 컴퓨터도 감당 가능)
- ipv4 -> ipv6로 변경할때 ipv4의 라우터가 ipv6의 패킷을 이해할 수 있도록 중간에 ipv4의 패킷으로 터널링해주는 라우터가 필요할 것이다.

## Routing Algorithm 1. Link state

---

- **다익스트라 알고리즘**  
  ![5-9](https://github.com/mjh851819/mjh851819.github.io/assets/70308520/1eb09840-959d-4023-9979-6fa48efeacc7)

- 알고리즘을 위해 네트워크를 그래프로 표현한다.
- 라우터는 노드, 링크는 간선이다.
- 이때 중요한점은 u라는 라우터에서 다익스트라 알고리즘을 구현하기 위해선 다른 모든 라우터로 가는 간선과 비용을 알고있어야 한다.
- 따라서 사전에 서로간의 정보를 전체 네트워크에 브로드캐스트할 필요가 있다.
- _다익스트라 알고리즘의 자세한 설명은 여기선 생략한다._
