---
title: "네트워크 4-4 hierarchical routing 과 BGP"

categories:
  - Network
tags:
  - Network
---

> 이 글은 KOCW에서 제공하는 한양대학교 이석복 교수님의 컴퓨터 네트워크 강의를 기반으로 내용을 정리하고 복습하기 위한 용도로 작성되었습니다.

## hierarchical routing

- 우리가 지금까지 배운 routing 알고리즘은 결국 실제 라우터에서 사용할 알고리즘들이다.
- 그런데 실제 라우터의 갯수는 셀 수 없이 많을테고 link state 알고리즘만 하더라도 모든 간선의 정보를 알고있어야 하며, 각 라우터마다 모든 라우터들에 대한 fowarding table을 저장하기에는 용량이 크게 부족할 것이다.
- 이러한 문제점은 네트워크의 계층화를 통해서 해결할 수 있다.

#### 1. AS(Autonomous system)

---

- 네트워크들은 각각 커다란 묶음이자 모임으로 계층화 되어서 존재하며 이러한 네트워크들을 연결하는 링크가 존재한다.
- 하나의 네트워크 내부에서 라우터끼리의 최단거리는 앞서 매운 link state, distance vector등의 알고리즘으로 계산하고(intra-AS, Autonomous system)
  이러한 네트워크들을 연결하는 링크간의 거리는 아직 배우지 않은 BGP알고리즘을 사용한다. (inter-AS, Autonomous system)
  > AS의 Autonomous는 자율화의, 자치화의 라는 의미로 한 네트워크 내부에서 자율적으로 결정을 내릴수 있다는 의미를 가지고있다.
- 네트워크를 하나의 AS로 보고 intra-AS는 네트워크 내부적으로 결정하는 알고리즘 inter-AS는 네트워크를 넘나드는 알고리즘으로 이해하면 편할것이다.

#### 2. BGP(Border Gateway Protocol)

---

> 그렇다면 앞서 배운 두 알고리즘은 어쨋든 라우터간의 최단거리를 구하는 알고리즘이었는데 BGP알고리즘의 목적도 이와 같을까?

**BGP(Border Gateway Protocol)의 정의**

- 각 네트워크의 게이트웨이를 넘나들면서 목적 네트워크를 찾기 위한 알고리즘

![5-13](https://github.com/mjh851819/mjh851819.github.io/assets/70308520/d2d0a276-4ae5-40e1-b35d-d8617a2089a8)

- 그림의 경우에서 AS1은 AS3와 AS2 이외의 네트워크로 갈 수 있는지는 물론이고 존재 자체도 알 방법이 없다.
- 따라서 AS3는 AS1에게 자신을 통하면 AS4와 같은 네트워크로 갈 수 있다는 접근성에 대한 정보를 전달해 줄 필요가 있다.
- 이런식으로 자신이 인지하고 있는 네트워크의 정보를 계속해서 전파는것이 BGP알고리즘의 개념적인 동작이다.
- 이러한 접근성 정보를 BGP messege라고 하며 prefix(네트워크명) + attribute의 구성을 가진다
- attribute에는 무슨 정보가 들어갈까?

#### 2. BGP의 개념

---

![5-14](https://github.com/mjh851819/mjh851819.github.io/assets/70308520/c7130954-b475-42ca-94eb-2384721c618f)

- 현대 인터넷에서 네트워크를 AS라고 자주 표현하는데 이러한 AS의 스케일은 천차만별이며 AS간 관계를 맺을때는 provider와 custumer의 관계가 존재한다.
- SKT와 한양대학교 네트워크가 관계를 맺는 계약을 한다고 가정하자. 당연스럽게 한양대학교 네트워크가 SKT에 돈을내며 두 네트워크를 연결할것이다.

  > 단순히 개념적으로 보았을때 네트워크간 관계에 provider와 custumer를 이해하기 힘들지만 현실적으로 생각해보면 이해하기 쉽다.  
  > 당장 우리가 네트워크를 만들어서 전세계 네트워크에 연결하고 싶다면 어딘가에 돈을 내야하듯이 말이다.

- 하지만 이렇게 단순히 provider와 custumer의 관계를 맺기 애매한 경우가 있다. (ex) skt - lg
- 서로가 서로를 동등한 만큼 필요로하고 공생할 수 있는 경우, 이런 관계는 pear 관계라고 표현한다.

  > 이러한 갑-을 관계나 공생관계는 시간이 지남에따라 언제든지 변화하거나 역전될 수 있다.

- 다시 돌아와서 inter-AS간의 트래픽 전송의 상황을 가정해보자.
- 조직적인 이름을 붙여서 SKT-KT가 pear관계, 한양대학교가 SKT, KT를 provider로 두는 custumer라고 가정해보자.
- BGP에 의해서 SKT가 KT로 트래픽을 전달할 때 단순 네트워크 거리 계산만을 통해서 SKT -> 한양대 -> KT로 전달하는 상황이 맞을까?
- 한양대학교는 자신의 custumer의 트래픽을 전달하는것이 아니므로 돈을 받을 수 없을 뿐더라 SKT와 KT의 회선을 사용하므로 돈을 오히려 지불해야한다.
- 따라서 이러한 트래픽 이동은 가능하지 않도록 설계되어 있다.

---

- 또다른 경우를 가정해보자
- SKT-KT-LG가 선형으로 pear관계를 맺고 있고 SKT에서 LG로 트래픽이 이동하는 상황이 있다.
- 이때 A-SKT-KT-LG-B의 경로의 문제가 무엇일까?
- 트래픽의 이동은 반드시 비용적인 수거가 이루어져야한다.
- 위 전송과정에서 SKT는 A에게 LG는 B에게 비용을 수거한다 KT는 당장 공생관계간의 데이터 이동이라 할지라도 자신이 비용을 수거할 수 없는 데이터 이동을 허용할 이유가 없다.

---

- 위와같은 잘못된 네트워크 라우팅의 경우의 수를 차단하기 위해서 BGP알고리즘이 동작한다.
- BGP알고리즘은 네트워크 경로를 설정할때 이러한 pear관계 provider - custumer관계를 비용적인 측면에서 문제가 발생하지 않도록 설계하며 이를 앞서 설명한 AS간의 접근성 정보전달을 과정의 attribute를 통한 정보를 전달하며 해결한다.

![5-15](https://github.com/mjh851819/mjh851819.github.io/assets/70308520/c9df907f-ef13-4bf2-a60d-f1f0cd777931)

- 다음 그림은 한양대학교가 AS1과의 경로를 탐색할때 BGF알고리즘이 작동하는 원리다.
- 앞서 설명한대로 한양대학교는 그저 최단거리가 아닌 provider-custumer관계상 비용적으로 가장 이득을 보는 경로를 선택한다.

- inter-AS BGP알고리즘은 이렇게 기술적인 최단거리를 계산하는것이 아닌 경제적이나 계층적인 관계를 계산해서 경로를 설정하는 알고리즘이다.
